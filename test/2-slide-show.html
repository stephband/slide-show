<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="author" content="stephband" />
    <meta name="description" content="<slide-show> test" />
    <meta name="viewport" content="width=device-width" />

    <title>&lt;slide-show&gt;</title>

    <script title="debug">
        window.DEBUG = true;
        window.slideshowStylesheet = '../shadow.css';
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
        }

        .main-slide-show,
        .centre-slide-show,
        .left-slide-show,
        .right-slide-show,
        .grid-slide-show {
            margin-top: 1rem;
            margin-left: auto;
            margin-right: auto;
            width: 80%;
            column-gap: 1rem;
            --padding-left: 3rem;
            --padding-right: 3rem;
        }

        slide-show > a,
        slide-show > a > img,
        slide-show > img {
            display: block;
            width: 100%;
            max-width: 100%;
        }

        .centre-slide-show,
        .left-slide-show,
        .right-slide-show {
            grid-auto-columns: 60%;
        }

        .left-slide-show > img {
            scroll-snap-align: start;
        }

        .right-slide {
            scroll-snap-align: end;
        }

        .grid-slide-show {
            grid-template-columns: 4rem 6rem 2rem 9rem 3rem;
        }
    </style>

    <link rel="stylesheet" href="../docs/module.css">
    <link rel="stylesheet" href="../element.css">
    <link rel="prefetch" href="../shadow.css">
</head>

<body>
    <pre>&lt;slide-show loop autoplay controls="navigation pagination fullscreen"&gt; - one child</pre>

    <slide-show loop autoplay controls="navigation pagination fullscreen">
        <img src="../docs/images/bourg.jpg" draggable="false" />
    </slide-show>

    <pre>&lt;slide-show loop controls="navigation pagination fullscreen"&gt; - 5 children</pre>

    <slide-show class="main-slide-show" controls="navigation pagination" loop>
        <a href="/" draggable="false" id="donkeys"><img src="../docs/images/donkeys.jpg" draggable="false" /></a>
        <a href="/" draggable="false" id="tractor"><img src="../docs/images/tractor.jpg" draggable="false" /></a>
        <a href="/" draggable="false" id="mauverin"><img src="../docs/images/mauverin.jpg" draggable="false" /></a>
        <a href="/" draggable="false" id="rocks"><img src="../docs/images/rocks.jpg" draggable="false" /></a>
        <a href="/" draggable="false" id="summit"><img src="../docs/images/summit.jpg" draggable="false" /></a>
    </slide-show>

    <pre>&lt;slide-show loop autoplay controls="navigation pagination fullscreen"&gt; - one child</pre>

    <slide-show class="main-slide-show" loop autoplay controls="navigation pagination fullscreen" active="#mauverin">
        <a href="/" draggable="false"><img src="../docs/images/donkeys.jpg" draggable="false" /></a>
        <a href="/" draggable="false"><img src="../docs/images/tractor.jpg" draggable="false" /></a>
        <a href="/" draggable="false" id="mauverin"><img src="../docs/images/mauverin.jpg" draggable="false" /></a>
        <a href="/" draggable="false"><img src="../docs/images/rocks.jpg" draggable="false" /></a>
        <a href="/" draggable="false"><img src="../docs/images/summit.jpg" draggable="false" /></a>
    </slide-show>

    <slide-show class="tab-slide-show">
        <a class="tab-button button" href="#1" draggable="false">Explore</a>
        <a class="tab-button button active" href="#2" draggable="false">Buy</a>
        <a class="tab-button button" href="#3" draggable="false">Free trial</a>
        <a class="tab-button button" href="#4" draggable="false">About</a>
        <a class="tab-button button" href="#5" draggable="false">Student discount</a>
        <a class="tab-button button" href="#6" draggable="false">Contact us</a>
    </slide-show>

    <pre>slide-show       { grid-auto-columns: 60%; }
slide-show > img { scroll-snap-align: center; }</pre>

    <slide-show class="centre-slide-show" active="#a">
        <img src="../docs/images/bourg.jpg" draggable="false" />
        <img src="../docs/images/tractor.jpg" draggable="false" id="a" />
        <img src="../docs/images/bourg.jpg" draggable="false" />
        <img src="../docs/images/tractor.jpg" draggable="false" />
        <img src="../docs/images/bourg.jpg" draggable="false" />
    </slide-show>

    <pre>slide-show       { grid-auto-columns: 60%; }
slide-show > img { scroll-snap-align: start; }</pre>

    <slide-show class="left-slide-show" active="#b">
        <img src="../docs/images/bourg.jpg" draggable="false" />
        <img src="../docs/images/tractor.jpg" draggable="false" id="b" />
        <img src="../docs/images/bourg.jpg" draggable="false" />
        <img src="../docs/images/tractor.jpg" draggable="false" />
        <img src="../docs/images/bourg.jpg" draggable="false" />
    </slide-show>

    <pre>slide-show       { grid-auto-columns: 60%; }
slide-show > img { scroll-snap-align: end; }</pre>

    <slide-show class="right-slide-show" active="c">
        <img class="right-slide" src="../docs/images/bourg.jpg" draggable="false" />
        <img class="right-slide" src="../docs/images/tractor.jpg" draggable="false" id="c" />
        <img class="right-slide" src="../docs/images/bourg.jpg" draggable="false" />
        <img class="right-slide" src="../docs/images/tractor.jpg" draggable="false" />
        <img class="right-slide" src="../docs/images/bourg.jpg" draggable="false" />
    </slide-show>

    <pre>slide-show { grid-template-columns: 4rem 6rem 2rem 9rem 3rem; }</pre>

    <slide-show class="grid-slide-show">
        <img src="../docs/images/bourg.jpg" draggable="false" />
        <img src="../docs/images/tractor.jpg" draggable="false" />
        <img src="../docs/images/bourg.jpg" draggable="false" />
        <img src="../docs/images/tractor.jpg" draggable="false" />
        <img src="../docs/images/bourg.jpg" draggable="false" />
    </slide-show>

    <script type="module">
        import '../element.js';

        /*
        document.body.addEventListener('slide-active', (e) => {
            console.log('EVENT', e.type, e.target);
        });
        */

        import test from '../modules/test.js';


        // -----

        test(0, 'create <slide-show> with no children', (done) => {
            const show = document.createElement('slide-show');
            done(show);
        });

        test(0, 'append <slide-show> to body', (done, show) => {
            const listener = (e) => {
                throw new Error('SHOULD NOT HAPPEN');
            };

            show.addEventListener('slide-active', listener);
            document.body.append(show);

            // Wait in case slide-active is sent
            setTimeout(() => {
                show.removeEventListener('slide-active', listener);
                done(show);
            }, 200, show);
        });

        test(0.2, 'activate null', (done, show) => {
            show.active = null;
            done(show);
        });

        test(0.2, 'activate non-child element', (done, show) => {
            show.active = document.body;
            done(show);
        });

        test(0.2, 'append child', (done, show) => {
            show.addEventListener('slide-active', (e) => {
                done(show);
            });

            const assign = Object.assign;
            const showImg0 = document.createElement('img');
            assign(showImg0, { draggable: false, src: "../docs/images/donkeys.jpg" });
            show.append(showImg0);
        });

        test(0.2, 'remove <slide-show>', (done, show) => {
            show.remove();
            done(show);
        });


        // -----

        test(0, 'create <slide-show> with 5 children', (done) => {
            const assign = Object.assign;

            const show     = document.createElement('slide-show');
            const showImg0 = document.createElement('img');
            const showImg1 = document.createElement('img');
            const showImg2 = document.createElement('img');
            const showImg3 = document.createElement('img');
            const showImg4 = document.createElement('img');

            assign(showImg0, { draggable: false, src: "../docs/images/donkeys.jpg" });
            assign(showImg1, { draggable: false, src: "../docs/images/tractor.jpg" });
            assign(showImg2, { draggable: false, src: "../docs/images/mauverin.jpg" });
            assign(showImg3, { draggable: false, src: "../docs/images/rocks.jpg" });
            assign(showImg4, { draggable: false, src: "../docs/images/summit.jpg" });

            show.append(showImg0, showImg1, showImg2, showImg3, showImg4);

            done(show);
        });

        test(0, 'append <slide-show> to body', (done, show) => {
            show.children[0].addEventListener('slide-active', (e) => {
                done(show);
            });

            document.body.append(show);
        });

        test(0.5, 'remove <slide-show> child', (done, show) => {
            show.children[1].addEventListener('slide-active', (e) => {
                done(show);
            });

            show.children[0].remove();
        });

        test(0, 'activate null', (done, show) => {
            show.active = null;
            done(show);
        });

        test(0.2, 'activate first child', (done, show) => {
            show.active = show.children[0];
            done(show);
        });

        test(0.2, 'activate second child', (done, show) => {
            show.active = show.children[1];
            done(show);
        });

        test(0.2, 'remove <slide-show>', (done, show) => {
            // Here we are removing it mid-scroll
            show.remove();
            done(show);
        });

        test(0.2, 'remove <slide-show> child while disconnected', (done, show) => {
            //show.children[1].addEventListener('slide-active', (e) => {
            //    throw new Error('Should not emit events while disconnected');
            //});

            show.children[0].remove();
            setTimeout(() => {
                done(show);
            }, 200);
        });

        test(0.2, 'activate <slide-show> child while disconnected', (done, show) => {
            //show.children[1].addEventListener('slide-active', (e) => {
            //    throw new Error('Should not emit events while disconnected');
            //});

            show.active = show.children[1];
            setTimeout(() => {
                done(show);
            }, 200);
        });

        test(0.2, 'append <slide-show> to document.body again', (done, show) => {
            document.body.append(show);

            // In FF we don't need to wait any frames, its visible immediately
            requestAnimationFrame(() =>
                requestAnimationFrame(() =>
                    // In Safari its visible now
                    // In Chrome it's visible but style has not been applied
                    requestAnimationFrame(() =>
                        // In Chrome it's all right now. Probably. Sometimes it
                        // needs one more.
                        requestAnimationFrame(() => {
                            // So is the active slide in view? Even roughly speaking?
                            done(show.active.getBoundingClientRect().left < 100);
                        })
                    )
                )
            );
        }, true);
/* */
    </script>
</body>
</html>
